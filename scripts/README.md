# Scripts Directory

Simple scripts for retrieving card data and inserting into the database.

## Directory Structure

```
scripts/
├── src/                     # Source scripts
│   ├── crawl_cards.py      # Crawl card data from yugioh.fandom.com (inserts to DB)
│   ├── gather_card_data.py # Gather card data and save to CSV
│   ├── check_db.py         # Check database state
│   ├── db_manager.py        # Database management utilities
│   ├── run_migrations.py   # Run database migrations
│   └── setup.py             # Smart database setup (main entry point)
├── data/                    # Data files
│   └── card_list.csv       # Card names CSV (001-900)
├── migrations/             # Database migration SQL files
│   └── V1__initial_schema.sql
└── tests/                  # Unit tests
    └── test_db_manager.py
```

## Quick Start

### Setup Database

```bash
cd scripts
DB_HOST=localhost DB_PORT=5432 python3 src/setup.py
```

This will:
- Check if database is empty
- Run migrations if needed
- Seed first 100 cards if needed

## Main Scripts

### `src/setup.py`
Smart database setup that checks state and only runs what's needed.

```bash
python3 src/setup.py
python3 src/setup.py --seed-range 1 100
```

### `src/crawl_cards.py`
Crawl card data from yugioh.fandom.com and insert into database.

```bash
python3 src/crawl_cards.py --start 1 --end 100 --workers 10
```

### `src/gather_card_data.py`
Gather card data from yugioh.fandom.com and save to CSV file (for database insertion).

```bash
python3 src/gather_card_data.py
python3 src/gather_card_data.py --start 1 --end 100 --workers 10
```

This script:
- Loads card names from `data/card_list.csv` (in project root)
- Fetches complete card data from yugioh.fandom.com
- Saves all card data to `data/cards_data.csv` (in project root)
- The output CSV can be used for bulk database insertion

### `src/run_migrations.py`
Run database migrations from `migrations/` directory.

```bash
python3 src/run_migrations.py
```

### `src/check_db.py`
Check database state:
- Exit 0: Database is empty (needs migrations)
- Exit 1: Database has tables but no cards (needs seeding)
- Exit 2: Database is populated (ready)

### `src/db_manager.py`
Database management utilities for resetting, clearing, and seeding.

```bash
python3 src/db_manager.py reset-db
python3 src/db_manager.py clear-all
python3 src/db_manager.py seed --cards
```

### Running Tests

```bash
cd scripts
pytest
```

Tests are located in `tests/` and can import modules from `src/` using `from src import <module>`.

## Environment Variables

All scripts use these environment variables (with defaults):
- `DB_HOST` (default: localhost)
- `DB_PORT` (default: 5432)
- `DB_NAME` (default: yugioh_db)
- `DB_USER` (default: yugioh_user)
- `DB_PASSWORD` (default: yugioh_password)

## Data Files

All data files are located in the `data/` directory at the project root (not in `scripts/data/`):

- `data/card_list.csv` - Contains all 900 card IDs and names from Yu-Gi-Oh! The Sacred Cards
- `data/cards_data.csv` - Complete card data CSV (generated by `gather_card_data.py`) with all fields needed for database insertion
